# SIP

会话发起协议（SIP，Session Initiation Protocol）是在VoIP技术中使用的最常见的协议之一。它是一种应用层协议，与其他应用层协议协同工作，以控制Internet上的多媒体通信会话。

### 优点

- 低成本
- 可移植性
- 无额外电缆
- 灵活性
- 视频会议

### 特别说明

- SIP是由IETF(因特网工程任务组)标准定义的应用层协议。 它在 **RFC 3261** 中定义。
- SIP体现了客户端 - 服务器体系结构以及来自 **HTTP** 的URL和URI以及来自 **SMTP** 的文本编码方案和标题样式的使用。
- SIP利用SDP(会话描述协议)的帮助，SDP描述了用于通过IP网络传递语音和视频的会话和RTP(实时传输协议)。
- SIP可用于双方(单播)或多方(多播)会话。
- 其他SIP应用包括文件传输，即时消息，视频会议，在线游戏和蒸汽多媒体分发。

### 适用位置

基本上SIP是一种应用层协议。它是用于创建和终止与一个或多个参与者的会话的简单网络信令协议。SIP协议被设计为独立于底层传输协议，因此SIP应用可以在TCP，UDP或其他低层网络协议上运行。

![](.\png\sip_network_location.png)

SIP协议用于两个或更多个端点之间的互联网电话和多媒体分发。基于文本的。



### 网络元素

在SIP中，每个网络元件由类似地址的 **SIP URI** (统一资源标识符)标识。以下是网络元素：

- 用户代理
- 代理服务器
- 注册服务器
- 重定向服务器
- 位置服务器

#### 用户代理

它是端点和SIP网络的最重要的网络元件之一。端点可以启动，修改或终止会话。可以是软电话，移动电话或笔记本电脑。

用户代理在逻辑上可分为两个部分：

- 用户代理客户端（UAC）--发送请求并接收响应的实体
- 用户代理服务器（UAS）--接收请求并发送响应的实体

SIP基于客户端 - 服务器架构，其中呼叫者的电话充当发起呼叫的客户端，并且被叫者的电话充当响应呼叫的服务器。

#### 代理服务器

它是从用户代理接收请求并将其转发给另一个用户的网络元素。

- 基本上代理服务器的作用就像一个路由器。
- 它具有一些智能来理解SIP请求并且在URI的帮助下向前发送它。
- 代理服务器位于两个用户代理之间。
- 源和目标之间最多可以有70个代理服务器。

有两种类型的代理服务器：

- 无状态代理服务器

  仅转发接收的消息。这种类型的服务器不存储呼叫或事务的任何信息

- 状态代理服务器

  此类型的代理服务器会跟踪收到的每个请求和响应，如果需要，将来可以使用它。如果没有来自另一方的响应，它可以重传请求。

#### 注册服务器

注册服务器接受来自用户代理的注册请求。它帮助用户在网络中验证自己。它将URI和用户的位置存储在数据库中，以帮助同一域中的其他SIP服务器。

![](.\png\SIP_注册服务器.png)

这里呼叫者想要注册到TMC域。因此它向TMC的注册服务器发送注册请求，并且服务器在授权客户端时返回200 OK响应。

#### 重定向服务器

重定向服务器接收请求并在由注册器创建的位置数据库中查找请求的预期接收者。

重定向服务器使用数据库获取位置信息，并以3xx(重定向响应)向用户作出响应。

#### 位置服务器

位置服务器向**重定向**和**代理服务器**提供关于呼叫者可能的位置的信息。

只有代理服务器或重定向服务器可以联系位置服务器。

![](.\png\Sip_网络元素架构.png)

### SIP-系统架构

![](.\png\Sip_系统架构.png)

- SIP的最低层是其**语法和编码**。其编码使用扩充的**背景 - 诺尔表单语法**(BNF)指定。
- 第二层是**传输层**。它定义了客户端如何发送请求和接收响应，以及服务器如何通过网络接收请求和发送响应。所有SIP元素都包含传输层。
- 接下来是**交易层**。事务是由客户机事务(使用传输层)发送到服务器事务的请求，以及从服务器事务发送回客户机的对该请求的所有响应。用户代理客户端(UAC)完成的任何任务都使用一系列事务进行。**无状态代理**不包含事务层。
- **交易层**上方的图层称为交易使用者。除了**无状态代理**，每个SIP实体都是事务用户。

### SIP基本呼叫流程

![](.\png\Sip基本呼叫流程.png)

上述调用流程的逐步解释：

- 发送到代理服务器的INVITE请求负责启动会话。
- 代理服务器立即向呼叫者(Alice)发送 **100 Trying** 响应以停止INVITE请求的重传。
- 代理服务器在位置服务器中搜索Bob的地址。在获得地址之后，它进一步转发INVITE请求。
- 此后，由Bob产生的 **180响铃**(临时响应)被返回给Alice。
- Bob在接听电话后立即生成 **200 OK** 响应。
- Bob收到 **200 OK** 时，Bob会收到来自Alice的 **ACK** 。
- 同时，会话建立并且RTP分组(对话)开始从两端流动。
- 在对话之后，任何参与者(Alice或Bob)可以发送 **BYE** 请求以终止会话。
- **BYE** 直接从Alice到Bob绕过代理服务器。
- 最后，Bob发送 **200 OK** 响应以确认BYE并且会话终止。
- 在上述基本呼叫流程中，三个**事务**(标记为1,2,3)可用。

完整的呼叫（从INVITE到 200 OK）称为 Dialog。

#### SIP梯形

代理如何帮助将一个用户与另一个用户连接？

![](.\png\Sip_连接_Sip梯形.png)

图中所示的拓扑称为SIP梯形。该过程如下进行:

- 当呼叫者发起呼叫时，向代理服务器发送INVITE消息。在接收到INVITE时，代理服务器尝试在DNS服务器的帮助下解析被调用者的地址。
- 在获得下一个路由之后，呼叫者的代理服务器(代理1，也称为出站代理服务器)将INVITE请求转发到被叫者的代理服务器，该代理服务器充当被叫者的入站代理服务器(代理2)。
- 入站代理服务器与位置服务器联系以获取有关用户注册的被叫方地址的信息。
- 在从位置服务器获取信息之后，它将呼叫转发到其目的地。
- 一旦用户代理知道他们的地址，他们可以绕过呼叫，即对话直接传递。

### SIP消息

SIP消息的两种类型：

- 请求

  请求的开始行包含定义请求的方法，以及定义请求发送位置的Request-URI。

- 响应

  响应的开始行包含响应代码

#### 请求方法

**SIP请求**是用于建立通信的代码。为了补充它们，存在 **SIP响应**，其通常指示请求是成功还是失败。这些称为方法的SIP请求使得SIP消息可行。

方法分为两种类型：

- 核心方法
- 扩展方法

#### 核心方法

##### INVITE

INVITE用于发起与用户代理的会话。

- INVITE可以在消息正文中包含呼叫者的媒体信息。
- 如果INVITE已经接收到成功响应(2xx)或者已经发送了ACK，则认为会话被建立。

![](.\png\Sip_INVITE.png)

- 成功的INVITE请求在两个用户代理之间建立**对话**，其继续，直到发送BYE以终止会话。
- 在已建立的对话中发送的INVITE被称为 **re-INVITE** 。
- Re-INVITE用于更改会话特征或刷新对话框的状态。

###### INVITE示例

```
INVITE sips:Bob@TMC.com SIP/2.0 
   Via: SIP/2.0/TLS client.ANC.com:5061;branch = z9hG4bK74bf9 
   Max-Forwards: 70 
   From: Alice<sips:Alice@TTP.com>;tag = 1234567 
   To: Bob<sips:Bob@TMC.com>
   Call-ID: 12345601@192.168.2.1  
   CSeq: 1 INVITE 
   Contact: <sips:Alice@client.ANC.com> 
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY 
   Supported: replaces 
   Content-Type: application/sdp 
   Content-Length: ...  
   
   v = 0 
   o = Alice 2890844526 2890844526 IN IP4 client.ANC.com 
   s = Session SDP 
   c = IN IP4 client.ANC.com 
   t = 3034423619 0 
   m = audio 49170 RTP/AVP 0 
   a = rtpmap:0 PCMU/8000 
```

##### BYTE

BYE是用于终止已建立的会话的方法。 这是一个SIP请求，可以由主叫方或被叫方发送以结束会话。

- 它不能由代理服务器发送。
- BYE请求通常绕过代理服务器端到端路由。
- BYE不能发送到挂起的INVITE或未建立的会话。

##### REGISTER

REGISTER请求执行用户代理的注册。此请求由用户代理发送到注册服务器。

- REGISTER请求可以被转发或代理，直到它到达指定域的权威注册器。
- 它在正在注册的用户的 **To** 头中携带AOR(记录地址)。
- REGISTER请求包含时间段(3600秒)。
- 一个用户代理可以代表另一个用户代理发送REGISTER请求。 这称为**第三方注册**。 这里， **From** 标签包含代表 **To** 标头中标识的一方提交注册的一方的URI。

##### CANCEL

CANCEL用于终止未建立的会话。用户代理使用此请求取消之前发起的待处理呼叫尝试。

- 它可以由用户代理或代理服务器发送。
- CANCEL是**逐跳**请求，即，它通过用户代理之间的元素并接收由下一个有状态元素产生的响应。

![](.\png\Sip_Cancel.png)

##### ACK

ACK用于确认对INVITE方法的最终响应。ACK总是向着INVITE的方向。如果在INVITE中不可用，ACK可以包含SDP主体(媒体特性)。

![](.\png\SIP_SDP_ACK.png)

- ACK可以不被用于修改已经在初始INVITE中发送的媒体描述。

  ![](.\png\SIP_ACK.png)

- 接收ACK的状态代理必须确定ACK是否应当向下游转发到另一个代理或用户代理。

- 对于2xx响应，ACK是端到端的，但是对于所有其他最终响应，当涉及状态代理时，其工作在逐跳基础上。

##### OPTIONS

OPTIONS方法用于向用户代理或代理服务器查询其功能，并发现其当前可用性。 对请求的响应列出了用户代理或服务器的功能。 代理永远不会生成OPTIONS请求。

#### 扩展方法

##### Subscribe

用户代理使用SUBSCRIBE来建立订阅，以获得关于特定事件的通知。

- 它包含一个 **Expires** 头字段，用于指示订阅的持续时间。
- 在该时间段过去之后，订阅将自动终止。
- 订阅在用户代理之间建立对话。
- 您可以在到期时间之前在对话框中发送另一个SUBSCRIBE再次重新订阅。
- 将收到来自用户的订阅的200 OK。
- 用户可以通过发送另一个SUBSCRIBE方法取消订阅，Expires值为0(零)。

![](.\png\SIP_SUBSCRIBE.png)

##### NOTIFY

NOTIFY用于由用户代理获取特定事件的发生。通常，当订阅者和通知者之间存在订阅时，NOTIFY将在对话框中触发。

- 每个NOTIFY将得到200 OK响应，如果它被通知器接收。
- NOTIFY包含指示事件的 **Event** 头字段和指示订阅当前状态的 **subscriptionstate** 头字段。
- NOTIFY总是在订阅的开始和终止时发送。

##### PUBLISH

PUBLISH由用户代理用于向服务器发送事件状态信息。

![](.\png\Sip_PUBLISH.png)

- 当有多个事件信息来源时，PUBLISH是最有用的。
- PUBLISH请求类似于NOTIFY，除了它不是在对话框中发送。
- PUBLISH请求必须包含 **Expires** 头字段和 **Min-Expires** 头字段。

##### REFER

REFER由用户代理使用来引用另一个用户代理来访问对话框的URI。

- REFER必须包含 **Refer-To** 标题。 这是REFER的必需标题。
- REFER可以在对话框内部或外部发送。
- A **202已接受**将触发REFER请求，其指示其他用户代理已接受引用。

##### INFO

INFO由用户代理用来向与其建立媒体会话的另一用户代理发送呼叫信令信息。

- 这是一个端到端的请求。
- 代理将始终转发INFO请求。

##### UPDATE

如果会话未建立，UPDATE用于修改会话的状态。 用户可以使用UPDATE更改编解码器。

![](.\png\Sip_UPDATE.png)

如果建立了会话，则使用重新邀请来改变/更新会话。

##### PRACK

PRACK用于确认接收到临时响应(1XX)的可靠传输。

- 通常，当客户端接收到包含 **RSeq** 可靠序列号和**支持的:100rel** 头部的临时响应时，PRACK就会生成。
- PRACK在 **rack** 标题中包含(RSeq＆amp; plus; CSeq)值。
- PRACK方法适用于所有临时响应，除了100 Trying响应，其从未可靠地传送。
- PRACK可以包含消息体; 它可以用于提供/应答交换。

##### MESSAGE

它用于使用SIP发送即时消息。IM通常包括从事文本会话的参与者实时交换的短消息。

![](.\png\Sip_Message.png)

- MESSAGE可以在对话框内或对话框外发送。
- MESSAGE的内容作为 **MIME** 附件在邮件正文中传送。
- 通常接收到 **200 OK** 响应以指示消息已在其目的地传送。

### SIP响应代码

SIP响应是由用户代理服务器(UAS)或SIP服务器生成的用于回复由客户端生成的请求的消息。它可以是防止UAC重传请求的正式确认。

- 响应可以包含UAC所需的信息的一些附加报头字段。
- SIP有六个响应。
- 1xx到5xx已从HTTP借用，6xx已在SIP中引入。
- 1xx被认为是**临时**响应，其余的是**最终**响应。

| 序号 | 功能和描述                                                   |
| :--: | ------------------------------------------------------------ |
|  1   | [1xx: 临时/信息响应]<br/>信息响应用于指示**呼叫进度**。 通常响应是端到端的(除了100 Trying)。 |
|  2   | [2xx: 成功响应]<br/>这类响应用于指示请求已被接受。           |
|  3   | [3xx: 重定向响应]<br/>通常这些类响应由重定向服务器响应INVITE发送。 它们也称为重定向类响应。 |
|  4   | [4xx: 客户端故障响应]<br/>客户端错误响应指示无法满足请求，因为从UAC侧识别出一些错误。 |
|  5   | [5xx: 服务器故障响应]<br/>此类响应用于指示由于服务器错误而无法处理请求。 |
|  6   | [6xx: 全局故障响应]<br/>此响应类指示服务器知道请求在尝试的任何地方都将失败。 因此，请求不应发送到其他位置。 |

### SIP报头

报头是传达关于消息的信息的SIP消息的组件。它被构造为头字段序列。

SIP头字段在大多数情况下遵循与HTTP头字段相同的规则。标题字段定义为 **Header:字段**，其中Header用于表示标题字段名称，字段是包含信息的标记集合。每个字段包含一个字段名称，后跟冒号(“:")和字段值(即**字段名称:字段值**)。

#### SIP报头-紧凑型

|      报头      | 紧凑型 |
| :------------: | :----: |
|       To       |   T    |
|      Via       |   V    |
|    Call-ID     |   I    |
|    Contact     |   M    |
|      From      |   F    |
|    Subject     |   S    |
| Content-Length |   I    |

#### SIP报头格式

典型SIP报头的结构。

![](.\png\Sip报头格式.png)

#### 报头分类

- 请求和响应

  详见 SIP 请求和响应报头字段.md

- 仅请求

  详见 SIP 仅请求报头字段.md

- 仅响应

  详见 SIP 仅响应报头字段.md

- 消息体

  详见 SIP 消息体报头字段.md

### SIP 会话描述协议

SDP代表会话描述协议。它用于描述参与者通过网络理解的格式的多媒体会话。根据该描述，一方决定是否加入会议或者何时或如何加入会议。

- 会议的所有者通过发送包含会话描述的多播消息在网络上广告它。所有者的名称，会话的名称，编码，时间等。根据这些信息，广告的接收者做出关于参与会话的决定。
- SDP通常包含在通常称为SIP的会话发起协议的主体部分中。
- SDP在RFC 2327中定义。SDP消息由一系列称为字段的行组成，其名称由单个小写字母缩写，并且以所需顺序来简化解析。

#### SDP的目的

SDP的目的是在多媒体会话中传达关于媒体流的信息，以帮助参与者加入或收集特定会话的信息。

- SDP是一个短结构化文本描述。

- 它传达会话的名称和目的，媒体，协议，编解码格式，定时和传输信息。

- 临时参与者检查这些信息并决定是否加入会话，以及如果它决定如何以及何时加入会话。

- 格式具有< type>形式的条目。 =< value>，其中< type> 定义唯一会话参数，并且< value> 提供该参数的特定值。

- SDP消息的一般形式是 -

  **x = parameter1参数2 ...参数N**

- 行以单个小写字母开头，例如x。字母和=之间从不存在任何空格，每个参数之间只有一个空格。每个字段都有一定数量的参数。

#### 会话描述参数

会话描述(*表示可选)

- v = (protocol version)
- o = (owner/creator and session identifier)
- s = (session name)
- i =* (session information)
- u =* (URI of description)
- e =* (email address)
- p =* (phone number)
- c =* (connection information - not required if included in all media)
- b =* (bandwidth information)
- z =* (time zone adjustments)
- k =* (encryption key)
- a =* (zero or more session attribute lines)

##### 协议版本

v =字段包含SDP版本号。因为SDP的当前版本是0，所以有效的SDP消息将始终以v = 0开始。

##### 所有者/创建者和会话标识符

o =字段包含有关会话发起者和会话标识符的信息。此字段用于唯一标识会话。

- 该字段包含 -

  o =< username>< session-id>< version>< network-type>< address-type>

- **用户名**参数包含发起方的登录名或主机。

- **session-id** 参数是用于确保唯一性的网络时间协议(NTP)时间戳或随机数。

- **版本**是一个数字字段，对于会话的每个更改都会增加，也建议为NTP时间戳。

- 对于Internet，**网络类型**始终为IN。address-type参数为IPv4或IPv6地址的IP4或IP6(点分十进制形式或完全限定的主机名)。

##### 会话名称

s =字段包含会话的名称。 它可以包含任何非零数字的字符。可选的i =字段包含有关会话的信息。它可以包含任意数量的字符。

##### URI

可选的u =字段包含具有关于会话的更多信息的统一资源指示符(URI)

##### 电子邮件地址

可选的e =字段包含会话主机的电子邮件地址。可选的p =字段包含电话号码。

##### 连接信息

c =字段包含有关介质连接的信息。

- 该字段包含 -

  c =< network-type>< address-type>< connection-address>

- 对于Internet， **network-type** 参数定义为IN。

- **地址类型**定义为IPv4地址的IP4和IPv6地址的IP6。

- **connection-address** 是将发送媒体数据包的IP地址或主机，可以是多播或单播。

- 如果组播，则connection-address字段包含 -

  connection-address = base-multicast-address / ttl / number-of-addresses

- 其中 **ttl** 是生存时间值，并且地址数量指示从基本多播地址开始包括多少个连续的多播地址。

##### 带宽信息

可选b =字段包含有关所需带宽的信息。 它的形式 -

b = modifier:bandwidth - value

##### 时间，重复次数和时区

t =字段包含会话的开始时间和停止时间。

t =开始时间停止时间

可选的r =字段包含有关可以在NTP或天( d 小>)，小时( h 小>)或分钟( > m )。

可选的 z =字段包含有关时区偏移的信息。如果发生的会话跨越从夏令时到标准时间的更改，则使用此字段，反之亦然。

##### 媒体公告

可选的 m =字段包含有关媒体会话类型的信息。 该字段包含 -

m =媒体端口传输格式列表

- 媒体参数是音频，视频，文本，应用程序，消息，图像或控件。port参数包含端口号。
- 传输参数包含使用的传输协议或RTP配置文件。
- 格式列表包含有关介质的更多信息。通常，它包含在RTP音频视频简档中定义的媒体有效载荷类型。

```
Example:
m = audio 49530 RTP/AVP 0 6 8 99
```

这三个编解码器之一可以用于音频媒体会话。如果意图是建立三个音频通道，则将使用三个单独的媒体字段。

##### 属性

可选的a =字段包含前面的媒体会话的属性。 此字段可用于**扩展SDP以提供有关介质的更多信息**。 如果SDP用户没有完全理解，则可以忽略属性字段。 媒体字段中列出的每个媒体有效内容类型可以有一个或多个属性字段。

SDP中的属性可以是

- session level, or
- media level.

会话级别意味着该属性在SDP中的第一个媒体行之前列出。 如果是这种情况，该属性将应用于其下的所有媒体行。

媒体级别表示它在媒体行之后列出。 在这种情况下，属性仅适用于该特定媒体流。

SDP可以包括会话级和媒体级属性。 如果相同的属性同时出现，则媒体级属性将覆盖该特定媒体流的会话级属性。 请注意，连接数据字段也可以是会话级或媒体级。

#### SDP示例

下面给出一个示例会话描述，取自RFC 2327

```
v = 0
o = mhandley2890844526 2890842807 IN IP4 126.16.64.4
s = SDP Seminar
i = A Seminar on the session description protocol
u = http://www.cs.ucl.ac.uk/staff/M.Handley/sdp.03.ps
e = mjh@isi.edu(Mark Handley)
c = IN IP4 224.2.17.12/127
t = 2873397496 2873404696
a = recvonly
m = audio 49170 RTP/AVP 0
m = video 51372 RTP/AVP 31
m = application 32416udp wb
a = orient:portrait
```

### SIP 应答模式

SDP与SIP的使用在SDP提议回答RFC 3264中给出。SIP中的默认消息体类型是 **application / sdp** 。

- 主叫方列出他们愿意在SDP中接收的媒体能力，通常在INVITE或ACK中。
- 被叫方在对INVITE的200 OK响应中列出它们的媒体能力。

#### SDP的典型SIP使用

SDP的典型SIP使用包括以下字段:版本，起源，主题，时间，连接以及一个或多个媒体和属性。

- 主题和时间字段不由SIP使用，但包括为了兼容性。
- 在SDP标准中，主题字段是必填字段，必须包含至少一个字符，如果没有主题，建议为s = - 。
- 时间字段通常设置为t = 00.SIP使用连接，媒体和属性字段在UA之间建立会话。
- 原始字段对SIP的使用有限。
- session-id通常在整个SIP会话中保持不变。
- 每次更改SDP时，版本都会增加。如果发送的SDP与之前发送的SDP没有变化，则版本保持不变。
- 由于要使用的媒体会话和编解码器的类型是连接协商的一部分，SIP可以使用SDP来指定多个替代媒体类型并且选择性地接受或拒绝那些媒体类型。

offer / answer规范RFC 3264建议对每个媒体字段使用包含a = rtpmap:的属性。 通过将SDP响应中相应的媒体字段的端口号设置为零来拒绝媒体流。

#### 例子

在以下示例中，呼叫者Tesla想要使用两个可能的音频编解码器和在初始INVITE中携带的SDP中的视频编解码器来建立音频和视频呼叫 ：

```
v = 0 
o = John 0844526 2890844526 IN IP4 172.22.1.102  
s = - 
c = IN IP4 172.22.1.102 
t = 0 0 
m = audio 6000 RTP/AVP 97 98 
a = rtpmap:97 AMR/16000/1 
a = rtpmap:98 AMR-WB/8000/1 
m = video 49172 RTP/AVP 32 
a = rtpmap:32 MPV/90000 
```

编解码器由RTP / AVP配置文件编号97,98引用。

被叫方Marry应答呼叫，为第一媒体字段选择第二编解码器，并且拒绝第二媒体字段，只想要AMR会话。

```
v = 0 
o = Marry 2890844526 2890844526 IN IP4 172.22.1.110 
s = - 
c = IN IP4 200.201.202.203 
t = 0 0 
m = audio 60000 RTP/AVP 8 
a = rtpmap:97 AMR/16000 
m = video 0 RTP/AVP 32 
```

如果此仅音频呼叫不可接受，则Tom将发送ACK，然后发送BYE以取消呼叫。否则，将建立音频会话并交换RTP分组。

如该示例所示，除非保持媒体字段的数量和顺序，否则呼叫方将不知道被叫方正在接受和拒绝哪些媒体会话。

提供/回答规则在以下部分中总结。

#### 生成要约的规则

SDP报价必须包括所有必需的SDP字段(这包括v =，o =，s =，c =和t =)。 这些是SDP中的必填字段。

它通常包括一个媒体字段( m = )，但它不必。 媒体行包含按优先顺序列出的所有编解码器。唯一的例外是，如果端点支持大量的编解码器，最可能被接受或最优选应该被列出。不同的媒体类型包括音频，视频，文本，MSRP，BFCP等。

#### 生成答案的规则

SDP对报价的回答必须根据以下规则构建:

- 答案必须具有与答案相同顺序的相同数量的 m = 行。
- **可以通过将端口号设置为0来拒绝单个媒体流**。
- 通过发送非零端口号接受流。
- 每个媒体类型的列出的有效载荷必须是报价中列出的有效载荷的子集。
- 对于动态有效载荷，不需要在每个方向上使用相同的动态有效载荷数。通常，只选择单个有效载荷。

#### 修改会话的规则

任一方可以发起另一个提议/应答交换以修改会话。**修改会话**时，必须遵循以下规则:

- 原始( o = )线路版本号必须与发送的最后一个版本号相同，这表示此SDP与前一个交换相同，或者可以递增一，表示新 必须解析的SDP。
- 优惠必须包含所有现有媒体行，并且必须按相同的顺序发送。
- 附加的媒体流可以添加到 m = 行列表的末尾。
- 可以通过将端口号设置为0来删除现有媒体流。此媒体行必须保留在SDP中以及此会话的所有将来的提供/应答交换。

#### 呼叫保持

呼叫中的一方可以暂时将另一方暂停。这通过发送具有与原始INVITE的SDP相同的SDP但具有 **a = sendonly** 属性的INVITE来完成。

通过发送具有 **a = sendrecv** 属性的另一个INVITE，该调用再次激活。下图显示了呼叫保持的呼叫流程。

![](.\png\SIP_呼叫保持.png)

